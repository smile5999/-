<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crowdfunding Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.5.3/web3.min.js"></script>
</head>
<body>
    <h1>Crowdfunding Platform</h1>
    <button id="connect-wallet-btn">Connect Wallet</button>
    <div id="campaigns"></div>
    <div id="create-campaign">
        <h2>Create Campaign</h2>
        <input type="text" id="title" placeholder="Title">
        <input type="text" id="description" placeholder="Description">
        <input type="number" id="goal" placeholder="Goal">
        <input type="number" id="deadline" placeholder="Deadline (timestamp)">
        <button id="create-campaign-btn">Create</button>
    </div>
    <div id="donate">
        <h2>Donate</h2>
        <input type="number" id="campaign-id" placeholder="Campaign ID">
        <input type="number" id="amount" placeholder="Amount">
        <button id="donate-btn">Donate</button>
    </div>
    <script>
        let web3;
        let accounts;
        let contract;

        const contractABI = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "creator",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "goal",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "deadline",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "title",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "description",
				"type": "string"
			}
		],
		"name": "CampaignCreated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "donator",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "Donated",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "campaigns",
		"outputs": [
			{
				"internalType": "address",
				"name": "creator",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "goal",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "deadline",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "amountCollected",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "title",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "description",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_goal",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_deadline",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_title",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_description",
				"type": "string"
			}
		],
		"name": "createCampaign",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_id",
				"type": "uint256"
			}
		],
		"name": "donateToCampaign",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_id",
				"type": "uint256"
			}
		],
		"name": "getCampaign",
		"outputs": [
			{
				"internalType": "address",
				"name": "creator",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "goal",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "deadline",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "amountCollected",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "title",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "description",
				"type": "string"
			},
			{
				"internalType": "address[]",
				"name": "donators",
				"type": "address[]"
			},
			{
				"internalType": "uint256[]",
				"name": "donations",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getNumberOfCampaigns",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "numberOfCampaigns",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}

            // 替换为从 Remix 获取的 ABI
        ];
        const contractAddress = "6080604052348015600e575f5ffd5b506112ec8061001c5f395ff3fe608060405260043610610054575f3560e01c806307ca140d14610058578063141961bc1461008257806342a4fda8146100c35780635598f8cc146100df578063b63e0eb014610122578063e4aafc2c1461015e575b5f5ffd5b348015610063575f5ffd5b5061006c610188565b6040516100799190610801565b60405180910390f35b34801561008d575f5ffd5b506100a860048036038101906100a39190610855565b61018d565b6040516100ba9695949392919061092f565b60405180910390f35b6100dd60048036038101906100d89190610855565b6102f0565b005b3480156100ea575f5ffd5b5061010560048036038101906101009190610855565b610430565b604051610119989796959493929190610b0a565b60405180910390f35b34801561012d575f5ffd5b5061014860048036038101906101439190610cce565b610695565b6040516101559190610801565b60405180910390f35b348015610169575f5ffd5b506101726107e1565b60405161017f9190610801565b60405180910390f35b5f5481565b6001602052805f5260405f205f91509050805f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060010154908060020154908060030154908060040180546101e390610d97565b80601f016020809104026020016040519081016040528092919081815260200182805461020f90610d97565b801561025a5780601f106102315761010080835404028352916020019161025a565b820191905f5260205f20905b81548152906001019060200180831161023d57829003601f168201915b50505050509080600501805461026f90610d97565b80601f016020809104026020016040519081016040528092919081815260200182805461029b90610d97565b80156102e65780601f106102bd576101008083540402835291602001916102e6565b820191905f5260205f20905b8154815290600101906020018083116102c957829003601f168201915b5050505050905086565b5f60015f8381526020019081526020015f209050806002015442111561034b576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161034290610e11565b60405180910390fd5b8060060133908060018154018082558091505060019003905f5260205f20015f9091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508060070134908060018154018082558091505060019003905f5260205f20015f909190919091505534816003015f8282546103e89190610e5c565b925050819055507f27e413b8931dc4cb7edc879292ebc482a3047336d03423ea91addae7a2cf850a823334426040516104249493929190610e8f565b60405180910390a15050565b5f5f5f5f6060806060805f60015f8b81526020019081526020015f209050805f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff168160010154826002015483600301548460040185600501866006018760070183805461049c90610d97565b80601f01602080910402602001604051908101604052809291908181526020018280546104c890610d97565b80156105135780601f106104ea57610100808354040283529160200191610513565b820191905f5260205f20905b8154815290600101906020018083116104f657829003601f168201915b5050505050935082805461052690610d97565b80601f016020809104026020016040519081016040528092919081815260200182805461055290610d97565b801561059d5780601f106105745761010080835404028352916020019161059d565b820191905f5260205f20905b81548152906001019060200180831161058057829003601f168201915b505050505092508180548060200260200160405190810160405280929190818152602001828054801561062257602002820191905f5260205f20905b815f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190600101908083116105d9575b505050505091508080548060200260200160405190810160405280929190818152602001828054801561067257602002820191905f5260205f20905b81548152602001906001019080831161065e575b505050505090509850985098509850985098509850985050919395975091939597565b5f4284116106d8576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106cf90610f42565b60405180910390fd5b5f60015f5f5481526020019081526020015f20905033815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550858160010181905550848160020181905550838160040190816107519190611100565b50828160050190816107639190611100565b505f5f815480929190610775906111cf565b91905055507f98a0d441b7626ac9b31750373850d01cdb57ad3406ddc03bb1d40a12c18de82260015f546107a99190611216565b33888888886040516107c096959493929190611249565b60405180910390a160015f546107d69190611216565b915050949350505050565b5f5f54905090565b5f819050919050565b6107fb816107e9565b82525050565b5f6020820190506108145f8301846107f2565b92915050565b5f604051905090565b5f5ffd5b5f5ffd5b610834816107e9565b811461083e575f5ffd5b50565b5f8135905061084f8161082b565b92915050565b5f6020828403121561086a57610869610823565b5b5f61087784828501610841565b91505092915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6108a982610880565b9050919050565b6108b98161089f565b82525050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f610901826108bf565b61090b81856108c9565b935061091b8185602086016108d9565b610924816108e7565b840191505092915050565b5f60c0820190506109425f8301896108b0565b61094f60208301886107f2565b61095c60408301876107f2565b61096960608301866107f2565b818103608083015261097b81856108f7565b905081810360a083015261098f81846108f7565b9050979650505050505050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b6109ce8161089f565b82525050565b5f6109df83836109c5565b60208301905092915050565b5f602082019050919050565b5f610a018261099c565b610a0b81856109a6565b9350610a16836109b6565b805f5b83811015610a46578151610a2d88826109d4565b9750610a38836109eb565b925050600181019050610a19565b5085935050505092915050565b5f81519050919050565b5f82825260208201905092915050565b5f819050602082019050919050565b610a85816107e9565b82525050565b5f610a968383610a7c565b60208301905092915050565b5f602082019050919050565b5f610ab882610a53565b610ac28185610a5d565b9350610acd83610a6d565b805f5b83811015610afd578151610ae48882610a8b565b9750610aef83610aa2565b925050600181019050610ad0565b5085935050505092915050565b5f61010082019050610b1e5f83018b6108b0565b610b2b602083018a6107f2565b610b3860408301896107f2565b610b4560608301886107f2565b8181036080830152610b5781876108f7565b905081810360a0830152610b6b81866108f7565b905081810360c0830152610b7f81856109f7565b905081810360e0830152610b938184610aae565b90509998505050505050505050565b5f5ffd5b5f5ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b610be0826108e7565b810181811067ffffffffffffffff82111715610bff57610bfe610baa565b5b80604052505050565b5f610c1161081a565b9050610c1d8282610bd7565b919050565b5f67ffffffffffffffff821115610c3c57610c3b610baa565b5b610c45826108e7565b9050602081019050919050565b828183375f83830152505050565b5f610c72610c6d84610c22565b610c08565b905082815260208101848484011115610c8e57610c8d610ba6565b5b610c99848285610c52565b509392505050565b5f82601f830112610cb557610cb4610ba2565b5b8135610cc5848260208601610c60565b91505092915050565b5f5f5f5f60808587031215610ce657610ce5610823565b5b5f610cf387828801610841565b9450506020610d0487828801610841565b935050604085013567ffffffffffffffff811115610d2557610d24610827565b5b610d3187828801610ca1565b925050606085013567ffffffffffffffff811115610d5257610d51610827565b5b610d5e87828801610ca1565b91505092959194509250565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680610dae57607f821691505b602082108103610dc157610dc0610d6a565b5b50919050565b7f43616d706169676e20646561646c696e6520686173207061737365642e0000005f82015250565b5f610dfb601d836108c9565b9150610e0682610dc7565b602082019050919050565b5f6020820190508181035f830152610e2881610def565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f610e66826107e9565b9150610e71836107e9565b9250828201905080821115610e8957610e88610e2f565b5b92915050565b5f608082019050610ea25f8301876107f2565b610eaf60208301866108b0565b610ebc60408301856107f2565b610ec960608301846107f2565b95945050505050565b7f54686520646561646c696e652073686f756c642062652061206461746520696e5f8201527f20746865206675747572652e0000000000000000000000000000000000000000602082015250565b5f610f2c602c836108c9565b9150610f3782610ed2565b604082019050919050565b5f6020820190508181035f830152610f5981610f20565b9050919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f60088302610fbc7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610f81565b610fc68683610f81565b95508019841693508086168417925050509392505050565b5f819050919050565b5f611001610ffc610ff7846107e9565b610fde565b6107e9565b9050919050565b5f819050919050565b61101a83610fe7565b61102e61102682611008565b848454610f8d565b825550505050565b5f5f905090565b611045611036565b611050818484611011565b505050565b5b81811015611073576110685f8261103d565b600181019050611056565b5050565b601f8211156110b85761108981610f60565b61109284610f72565b810160208510156110a1578190505b6110b56110ad85610f72565b830182611055565b50505b505050565b5f82821c905092915050565b5f6110d85f19846008026110bd565b1980831691505092915050565b5f6110f083836110c9565b9150826002028217905092915050565b611109826108bf565b67ffffffffffffffff81111561112257611121610baa565b5b61112c8254610d97565b611137828285611077565b5f60209050601f831160018114611168575f8415611156578287015190505b61116085826110e5565b8655506111c7565b601f19841661117686610f60565b5f5b8281101561119d57848901518255600182019150602085019450602081019050611178565b868310156111ba57848901516111b6601f8916826110c9565b8355505b6001600288020188555050505b505050505050565b5f6111d9826107e9565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff820361120b5761120a610e2f565b5b600182019050919050565b5f611220826107e9565b915061122b836107e9565b925082820390508181111561124357611242610e2f565b5b92915050565b5f60c08201905061125c5f8301896107f2565b61126960208301886108b0565b61127660408301876107f2565b61128360608301866107f2565b818103608083015261129581856108f7565b905081810360a08301526112a981846108f7565b905097965050505050505056fea26469706673582212202a910fadc7c0da822a962e023b74a5bdb837aeb7f5b3aa8e6b0d85fc84be1cc164736f6c634300081e0033"; // 替换为实际部署的合约地址

        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    contract = new web3.eth.Contract(contractABI, contractAddress);
                    document.getElementById("connect-wallet-btn").innerText = "Connected";
                } catch (error) {
                    console.error("Failed to connect to wallet:", error);
                }
            } else {
                console.error("Please install MetaMask!");
            }
        }

        async function createCampaign() {
            const title = document.getElementById("title").value;
            const description = document.getElementById("description").value;
            const goal = document.getElementById("goal").value;
            const deadline = document.getElementById("deadline").value;

            try {
                await contract.methods.createCampaign(goal, deadline, title, description).send({ from: accounts[0] });
                alert("Campaign created successfully!");
            } catch (error) {
                console.error("Failed to create campaign:", error);
            }
        }

        async function donate() {
            const campaignId = document.getElementById("campaign-id").value;
            const amount = document.getElementById("amount").value;

            try {
                await contract.methods.donateToCampaign(campaignId).send({ from: accounts[0], value: web3.utils.toWei(amount, 'ether') });
                alert("Donation successful!");
            } catch (error) {
                console.error("Failed to donate:", error);
            }
        }

        document.getElementById("connect-wallet-btn").addEventListener("click", connectWallet);
        document.getElementById("create-campaign-btn").addEventListener("click", createCampaign);
        document.getElementById("donate-btn").addEventListener("click", donate);
    </script>
</body>
</html>